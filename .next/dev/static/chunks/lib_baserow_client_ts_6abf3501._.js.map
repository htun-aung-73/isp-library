{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbookair/Documents/web/library-management-system/lib/baserow/client.ts"],"sourcesContent":["// Baserow API Client\n\nimport {\n    BaserowListResponse,\n    BaserowBook,\n    BaserowAuthor,\n    BaserowUser,\n    BaserowBorrowedBook,\n    mapBaserowBookToBook,\n    mapBaserowBorrowedBook,\n    Book,\n    BorrowedBook,\n} from \"./types\"\n\nconst BASEROW_API_URL = process.env.NEXT_PUBLIC_BASEROW_API_URL || \"https://api.baserow.io\"\nconst BASEROW_API_TOKEN = process.env.NEXT_PUBLIC_BASEROW_API_TOKEN || \"\"\n\n// Table IDs\nconst TABLE_BOOKS = process.env.NEXT_PUBLIC_BASEROW_TABLE_BOOKS || \"\"\nconst TABLE_AUTHORS = process.env.NEXT_PUBLIC_BASEROW_TABLE_AUTHORS || \"\"\nconst TABLE_PUBLISHERS = process.env.NEXT_PUBLIC_BASEROW_TABLE_PUBLISHERS || \"\"\nconst TABLE_USERS = process.env.NEXT_PUBLIC_BASEROW_TABLE_USERS || \"\"\nconst TABLE_BORROW_BOOKS = process.env.NEXT_PUBLIC_BASEROW_TABLE_BORROW_BOOKS || \"\"\n\n/**\n * Base fetch function for Baserow API\n */\nasync function baserowFetch<T>(\n    url: string,\n    options: RequestInit = {}\n): Promise<T> {\n\n    const httpsUrl = url.replace(\"http://\", \"https://\")\n\n    const response = await fetch(httpsUrl, {\n        ...options,\n        headers: {\n            \"Authorization\": `Token ${BASEROW_API_TOKEN}`,\n            \"Content-Type\": \"application/json\",\n            ...options.headers,\n        },\n    })\n\n    if (!response.ok) {\n        const error = await response.text()\n        throw new Error(`Baserow API error: ${response.status} - ${error}`)\n    }\n\n    return response.json()\n}\n\n/**\n * Fetch all pages from a Baserow list endpoint\n */\nasync function baserowFetchAll<T>(initialEndpoint: string): Promise<T[]> {\n    let allResults: T[] = []\n    let nextUrl: string | null = initialEndpoint\n\n    // Improve performance by requesting max page size (200) if not specified\n    if (!nextUrl.includes(\"size=\")) {\n        nextUrl += nextUrl.includes(\"?\") ? \"&size=200\" : \"?size=200\"\n    }\n\n    while (nextUrl) {\n        const response: BaserowListResponse<T> = await baserowFetch<BaserowListResponse<T>>(nextUrl)\n        allResults = [...allResults, ...response.results]\n        nextUrl = response.next\n    }\n\n    return allResults\n}\n\n/**\n * Get all books with author data\n */\nexport async function getBooks(): Promise<Book[]> {\n    const results = await baserowFetchAll<BaserowBook>(\n        `${BASEROW_API_URL}/api/database/rows/table/${TABLE_BOOKS}/?user_field_names=true`\n    )\n    return results.map(mapBaserowBookToBook)\n}\n\n/**\n * Get a single book by ID\n */\nexport async function getBook(id: string): Promise<Book | null> {\n    try {\n        const { results } = await baserowFetch<BaserowListResponse<BaserowBook>>(\n            `${BASEROW_API_URL}/api/database/rows/table/${TABLE_BOOKS}/?user_field_names=true&filter__book_id__equal=${id}`\n        )\n        return mapBaserowBookToBook(results[0])\n    } catch {\n        return null\n    }\n}\n\n/**\n * Get all authors\n */\nexport async function getAuthors(): Promise<BaserowAuthor[]> {\n    const results = await baserowFetchAll<BaserowAuthor>(\n        `${BASEROW_API_URL}/api/database/rows/table/${TABLE_AUTHORS}/?user_field_names=true`\n    )\n    return results\n}\n\n/**\n * Get user by email (for login)\n */\nexport async function getUserByEmail(email: string): Promise<BaserowUser | null> {\n    try {\n        const response = await baserowFetch<BaserowListResponse<BaserowUser>>(\n            `${BASEROW_API_URL}/api/database/rows/table/${TABLE_USERS}/?user_field_names=true&filter__email__equal=${encodeURIComponent(email)}`\n        )\n        return response.results[0] || null\n    } catch {\n        return null\n    }\n}\n\n/**\n * Get user by ID\n */\nexport async function getUserById(id: string): Promise<BaserowUser | null> {\n    try {\n        const user = await baserowFetch<BaserowUser>(\n            `${BASEROW_API_URL}/api/database/rows/table/${TABLE_USERS}/${id}/?user_field_names=true`\n        )\n        return user\n    } catch {\n        return null\n    }\n}\n\n/**\n * Get borrowed books for a user\n */\nexport async function getBorrowedBooks(userId: string): Promise<BorrowedBook[]> {\n    try {\n        const response = await baserowFetch<BaserowListResponse<BaserowBorrowedBook>>(\n            `${BASEROW_API_URL}/api/database/rows/table/${TABLE_BORROW_BOOKS}/?user_field_names=true&filter__user_id__link_row_contains=${userId}`\n        )\n        return response.results.map(mapBaserowBorrowedBook)\n    } catch {\n        return []\n    }\n}\n\n/**\n * Create a borrow record\n */\nexport async function createBorrowRecord(data: {\n    bookId: string\n    userId: string\n    dueDate: string\n}): Promise<BorrowedBook | null> {\n    try {\n        const response = await baserowFetch<BaserowBorrowedBook>(\n            `${BASEROW_API_URL}/api/database/rows/table/${TABLE_BORROW_BOOKS}/?user_field_names=true`,\n            {\n                method: \"POST\",\n                body: JSON.stringify({\n                    book_id: data.bookId,\n                    user_id: data.userId,\n                    borrowed_at: new Date().toISOString(),\n                    due_date: data.dueDate,\n                    status: \"borrowed\",\n                }),\n            }\n        )\n        return mapBaserowBorrowedBook(response)\n    } catch {\n        return null\n    }\n}\n\n/**\n * Update a borrow record (e.g., mark as returned)\n */\nexport async function updateBorrowRecord(\n    id: string,\n    data: Partial<{\n        returned_at: string\n        status: \"borrowed\" | \"returned\" | \"overdue\"\n    }>\n): Promise<BorrowedBook | null> {\n    try {\n        const response = await baserowFetch<BaserowBorrowedBook>(\n            `${BASEROW_API_URL}/api/database/rows/table/${TABLE_BORROW_BOOKS}/${id}/?user_field_names=true`,\n            {\n                method: \"PATCH\",\n                body: JSON.stringify(data),\n            }\n        )\n        return mapBaserowBorrowedBook(response)\n    } catch {\n        return null\n    }\n}\n\n/**\n * Create a new user (for sign-up)\n */\nexport async function createUser(data: {\n    email: string\n    password: string\n    username?: string\n}): Promise<BaserowUser | null> {\n    try {\n        const response = await baserowFetch<BaserowUser>(\n            `${BASEROW_API_URL}/api/database/rows/table/${TABLE_USERS}/?user_field_names=true`,\n            {\n                method: \"POST\",\n                body: JSON.stringify({\n                    email: data.email,\n                    password: data.password, // Should be hashed before sending\n                    username: data.username || null,\n                    is_admin: false,\n                }),\n            }\n        )\n        return response\n    } catch {\n        return null\n    }\n}\n\n"],"names":[],"mappings":"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"}}]
}
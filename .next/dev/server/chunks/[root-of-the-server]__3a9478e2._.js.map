{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbookair/Documents/web/library-management-system/proxy.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from \"next/server\"\n\nconst SESSION_COOKIE_NAME = \"library_session\"\n\nexport async function proxy(request: NextRequest) {\n    const sessionCookie = request.cookies.get(SESSION_COOKIE_NAME)\n\n    // Protect routes that require authentication\n    const protectedPaths = [\"/my-books\", \"/books\", \"/analytics\"]\n    const adminPaths = [\"/admin\"]\n    const isProtectedPath = protectedPaths.some((path) => request.nextUrl.pathname.startsWith(path))\n    const isAdminPath = adminPaths.some((path) => request.nextUrl.pathname.startsWith(path))\n\n    // Redirect to login if accessing protected routes without session\n    if ((isProtectedPath || isAdminPath) && !sessionCookie?.value) {\n        const url = request.nextUrl.clone()\n        url.pathname = \"/auth/login\"\n        return NextResponse.redirect(url)\n    }\n\n    // Check admin access for admin paths\n    if (isAdminPath && sessionCookie?.value) {\n        try {\n            const session = JSON.parse(sessionCookie.value)\n            if (!session.isAdmin) {\n                const url = request.nextUrl.clone()\n                url.pathname = \"/admin\"\n                return NextResponse.redirect(url)\n            }\n        } catch {\n            // Invalid session, redirect to login\n            const url = request.nextUrl.clone()\n            url.pathname = \"/auth/login\"\n            return NextResponse.redirect(url)\n        }\n    }\n\n    return NextResponse.next()\n}\n\nexport const config = {\n    matcher: [\n        /*\n         * Match all request paths except for the ones starting with:\n         * - api (API routes)\n         * - _next/static (static files)\n         * - _next/image (image optimization files)\n         * - favicon.ico (favicon file)\n         */\n        \"/((?!api|_next/static|_next/image|favicon.ico).*)\",\n    ],\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,sBAAsB;AAErB,eAAe,MAAM,OAAoB;IAC5C,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAE1C,6CAA6C;IAC7C,MAAM,iBAAiB;QAAC;QAAa;QAAU;KAAa;IAC5D,MAAM,aAAa;QAAC;KAAS;IAC7B,MAAM,kBAAkB,eAAe,IAAI,CAAC,CAAC,OAAS,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAC1F,MAAM,cAAc,WAAW,IAAI,CAAC,CAAC,OAAS,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAElF,kEAAkE;IAClE,IAAI,CAAC,mBAAmB,WAAW,KAAK,CAAC,eAAe,OAAO;QAC3D,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,OAAO,8QAAY,CAAC,QAAQ,CAAC;IACjC;IAEA,qCAAqC;IACrC,IAAI,eAAe,eAAe,OAAO;QACrC,IAAI;YACA,MAAM,UAAU,KAAK,KAAK,CAAC,cAAc,KAAK;YAC9C,IAAI,CAAC,QAAQ,OAAO,EAAE;gBAClB,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;gBACjC,IAAI,QAAQ,GAAG;gBACf,OAAO,8QAAY,CAAC,QAAQ,CAAC;YACjC;QACJ,EAAE,OAAM;YACJ,qCAAqC;YACrC,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;YACjC,IAAI,QAAQ,GAAG;YACf,OAAO,8QAAY,CAAC,QAAQ,CAAC;QACjC;IACJ;IAEA,OAAO,8QAAY,CAAC,IAAI;AAC5B;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;;;;;;SAMC,GACD;KACH;AACL"}}]
}